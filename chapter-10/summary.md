# 第10章 数、文字、そして文字列

- 「表現はプログラミングの本質である」：FredBrooks 人月の神話
    - CommonLispを構成する基本部品 関数、変数、マクロ、25の特殊オペレータ
- CommonLisp にはたくさんの組み込み型が準備されている
    - 数（整数、不動少数、複素数）
    - 文字
    - 文字列
    - 配列（多次元配列を含む
    - リスト
    - ハッシュテーブル
    - 入出力ストリーム
    - ファイル名の抽象化

- この章では スカラー なデータ型 について解説する
    - 数（整数、不動少数、複素数）
    - 文字
    - 文字列

## 10.1 数

- Lispは数学と相性が良い
- 整数はほとんど無限長の長さ（限界はある）を持てる
- 正確な分数がサポートされている (10/4 等)
    - 分数は任意の精度の有理数を表すことができる
- 浮動少数点型のサポート
    - Float
- 複素数をサポート
- 数値計算は遅い
    - 精度無制限の数値を扱うため計算量が多い
    - 数値の型情報を制限することでチューニングはできる
    - 高速計算が必要な場合、精度を諦めて浮動小数点演算を使用したほうがいい

## 10.2 数値リテラル

- いろいろな数値リテラルの書き方がある
- 忘れてはいけないこと
    - Lisp読取器；テキストをLispオブジェクトに変える
    - Lisp評価器；Lispオブジェクトを評価する
    - Lispオブジェクトが評価後、入力テキストと同じ書式になるとは限らない
```
? 10
10
? 20/2
10
? #xa
10
```
- 有理数とその標準形
- 整数、分数、二進数（#B,#b）、八進数（#O,#o）、16進数（#X,#x）、それ以外の基数（#nr）
```
? 123
123
? +123
123
? -123
-123
? 123.
123
? 2/3
2/3
? -2/3
-2/3
? 4/6
2/3
? 6/3
2
? #b10101
21
? #b10101/10101
1
? #o7
7
? #o777
511
? #xDADA
56026
? #36rABCDEFGHIJKLMNOPQRSTUVWXYZ
8337503854730415241050377135811259267835
```

- 浮動小数点（short、single、double、long）
```
? 1.0
1.0
? 1e0
1.0
? 1d0
1.0D0
? 123.0
123.0
? 123e0
123.0
? 0.123
0.123
? .123
0.123
? 123e-3
0.123
? 123E-3
0.123
? 0.123e20
1.23E+19
? 123d23
1.23D+25
```

- 複素数
    - 実数部と虚数部で表現
    - 実数部と虚数部は 両方とも有理数か同じ種類の浮動小数点型である必要がある
    - 種類が違う浮動小数点型が使われた場合、表現の津用法に引き上げられる
    - 虚部が0 の複素数はない；有理数に変換される
```
? #c(2 1)
#C(2 1)
? #c(2/3 3/4)
#C(2/3 3/4)
? #c(2 1.0)
#C(2.0 1.0)
? #c(2.0 1.0d0)
#C(2.0D0 1.0D0)
? #c(1/2 1.0)
#C(0.5 1.0)
? #c(3 0)
3
? #c(1/2 0)
1/2
? #c(-6/3 0)
-2
```

## 10.3 基本的な数学

- 基本的な代数演算（加算、減算、積算、除算） は `+`、`-`、`*`、`/` という関数でサポート
    - 複数の引数を与えられる
    - 単一の引数しか割り当てられない場合
        - `+`, `*` は値そのものを返す
        - `-` は反転を返す
        - `/` は逆数を返す
```
? (+ 1 2)
3
? (+ 1 2 3)
6
? (+ 10.0 3.0)
13.0
? (+ #c(1 2) #c(3 4))
#C(4 6)
? (- 5 4)
1
? (- 2)
-2
? (- 10 3 5)
2
? (* 2 3)
6
? (* 2 3 4)
24
? (/ 10 5)
2
? (/ 2 3)
2/3
? (/ 4)
1/4
```

- 引数が全て同じ型の数値なら結果も同じ型になる
    - 有理数からなる複素数演算で虚数が0になる場合、結果は有理数になる
    - 実数の引数の中に浮動小数点が一つでもあれば最も表現が広い範囲のものに変換される
    - 複素数も同様に一つでも引数にあれば対応する複素数に変換される
```
? (+ 1 2.0)
3.0
? (/ 2 3.0)
0.6666667
? (+ #c(1 2) 3)
#C(4 2)
? (+ #c(1 2) 3/2)
#C(5/2 2)
? (+ #c(1 1) #c(2 -1))
3
```
- `/` は結果を切り捨てないため切り捨てや丸めなどの関数が用意されている
    - `FLOOR` : 負の無限大の方向に切り捨てる
    - `CEILING` ： 正の無限大方向に切り上げる
    - `ROUND` : 最も近い整数に丸める。ちょうど中間値の場合偶数方向に丸める
    - `MOD` `REM` ： JIS素通しの割り算における法、剰余を返す
- `1+` `1-` 関数
    - 数値に1 を加算、減算した数値を返す関数
    - 関数は新しい数値を返す
- `INCF` `DECF` 関数
    - 数値に1 を加算、減算した数値を返す関数
    - 関数は引数で与えられた数値を変更する

## 10.4 数値比較

- `EQL` は型と値両方を比較する
- 関数`=` は数の等値を比較する
    - 型の違いを無視して数学的な値を比較する
    - なお より包括的な比較`EQUALP` は数値の比較に `=` を使用する
- 3つ以上の引数が与えられたときは、その全てが同じ値のときにTを返す
```
? (= 1 1)
T
? (= 10 20/2)
T
? (= 1 1.0 #c(1.0 0.0) #c(1 0))
T
```
- `/=` 関数は引数全てが異なる値のときにTを返す
```
? (/= 1 1)
NIL
? (/= 1 2)
T
? (/= 1 2 3)
T
? (/= 1 2 3 1)
NIL
? (/= 1 2 3 1.0)
NIL
```
- `<` `>` `<=` `>=` は有理数と不動少数の順序関数
    - 3つ以上の引数を取ることができ左から右に向かって評価を行う
```
? (< 2 3)
T
? (> 2 3)
NIL
? (> 3 2)
T
? (< 2 3 4)
T
? (< 2 3 3)
NIL
? (<= 2 3 3)
T
? (<= 2 3 3 4)
T
? (<= 2 3 4 3)
NIL
```
- いくつかの数から最大、最小を取得したい場合は`MIN` `MAX` 関数を使う
```
? (max 10 11)
11
? (min -12 -10)
-12
? (max -1 2 -3)
2
```

- `ZEROP` : 実数が0に等しいか
- `MINUSP`：0より小さいか
- `PLUSP`：0より大きいか
- 関数名末尾の `P`
    - 述語関数の標準的な命名規則
    - 述語(predicate)と呼ばれるため
    - 真偽値を返す
```
? (zerop 0)
T
? (zerop 0.0)
T
? (zerop -1)
NIL
? (minusp 0)
NIL
? (minusp -1)
T
? (minusp 2)
NIL
? (plusp 2)
T
? (plusp 0)
NIL
? (plusp -1)
NIL
```

## 10.5 高度な数学

- 以下の組み込み算術関数もサポートされている
    - 対数 `LOG`
    - 指数 `EXP` `EXPT`
    - 三角関数 `SIN` `COS` `TAN`
    - 三角関数の逆関数 `ASIN` `ACOS` `ATAN`
    - 双極関数 `SINH` `COSH` `TANH`
    - 双極関数の逆関数 `ASINH` `ACOSH` `ATANH`
    - 他にも色々あるのでリファレンスを見てね

## 10.6 文字

- 文字は数ではない
    - CommonLispの標準化時に文字に特定の表現を強制しなかった
    - Unicode がネイティブの文字エンコーディングの処理系もある

- 文字シンタックス
    - `#\` のあとに続ける
    - ex
        - `#\x` -> `x`
        - 空白やタブも同じように書ける
        - 見にくいため一部の文字では特定の名前がついている
            - 使える文字は処理系に依存する
            - `#\Space` `#\Newline` `#\Tab` `#\Page` `#\Rubout` `#\Linefeed` `#\Return` `#\Backspace`
            - Space, Newline は全ての処理系でサポートされている

## 10.7 文字比較

- 文字では数ではないので 数を比較する関数`<` `>` などは使えない
- 数の比較関数と対になる関数がそれぞれ２種類ずつ用意されている
    - 大文字小文字を区別するもの
    - 大文字小文字を区別しないもの

| 数 | 文字（大文字小文字を区別する） | 文字（区別しない） |
| --- | --- | --- |
| `=`  | `CHAR=`  | `CHAR-EQUAL` |
| `/=` | `CHAR/=` | `CHAR-NOT-EQUAL` |
| `<`  | `CAHR<`  | `CHAR-LESSP` |
| `>`  | `CHAR>`  | `CHAR-GREATERP` |
| `<=` | `CHAR<=` | `CHAR-NOT-GRATERP` |
| `>=` | `CHAR>=` | `CHAR-NOT-LESSP` |

## 10.8 文字列

- 文字列は文字の一次元配列で合成データ型
- この章では文字列のシンタックスについて説明する
    - 文字列リテラルは`"` で括る
    - 文字列リテラルには `"` `\` を除いたサポートされている全ての文字を含めることができる
    - バックスラッシュ `\` でエスケープすれば`"` `\`  も使用できる
    - 全ての文字はエスケープ可能
- REPL では文字列シンタックスのまま表示するため実際の表現はFORMAT関数を通す必要がある
```
? "foo\"bar"
"foo\"bar"
? (format t "foo\"bar")
foo"bar
NIL
?
```
## 10.9 文字列比較

- 文字列はcharと同じような関数で比較可能

| 数 | 文字（大文字小文字を区別する） | 文字（区別しない） |
| --- | --- | --- |
| `=`  | `STRING=`  | `STRING-EQUAL` |
| `/=` | `STRING/=` | `STRING-NOT-EQUAL` |
| `<`  | `STRING<`  | `STRING-LESSP` |
| `>`  | `STRING>`  | `STRING-GREATERP` |
| `<=` | `STRING<=` | `STRING-NOT-GRATERP` |
| `>=` | `STRING>=` | `STRING-NOT-LESSP` |

- 文字列は文字列同士でしか比較できない
- 部分文字列を比較可能
    - `:start1` `:start2` `:end1` `:end2`
    ```
    (string= "foobarbaz" "quuxbarfoo" :start1 3 :end1 6 :start2 4 :end2 7)
    T
    ```
- 文字列が異なるときに真になる比較関数
    - 違いが見つかったときのインデックスを返却する
    ```
    (string/= "lisp" "lisper")
    4
    ```
    - 部分文字列の場合は元の文字のインデックス
    ```
    (string< "foobar" "abaz" :start1 3 :start2 1)
    5
    ```

