# 第10章 数、文字、そして文字列

- 「表現はプログラミングの本質である」：FredBrooks 人月の神話
    - CommonLispを構成する基本部品 関数、変数、マクロ、25の特殊オペレータ
- CommonLisp にはたくさんの組み込み型が準備されている
    - 数（整数、不動少数、複素数）
    - 文字
    - 文字列
    - 配列（多次元配列を含む
    - リスト
    - ハッシュテーブル
    - 入出力ストリーム
    - ファイル名の抽象化

- この章では スカラー なデータ型 について解説する
    - 数（整数、不動少数、複素数）
    - 文字
    - 文字列

## 10.1 数

- Lispは数学と相性が良い
- 整数はほとんど無限長の長さ（限界はある）を持てる
- 正確な分数がサポートされている (10/4 等)
    - 分数は任意の精度の有理数を表すことができる
- 浮動少数点型のサポート
    - Float
- 複素数をサポート
- 数値計算は遅い
    - 精度無制限の数値を扱うため計算量が多い
    - 数値の型情報を制限することでチューニングはできる
    - 高速計算が必要な場合、精度を諦めて浮動小数点演算を使用したほうがいい

## 10.2 数値リテラル

- いろいろな数値リテラルの書き方がある
- 忘れてはいけないこと
    - Lisp読取器；テキストをLispオブジェクトに変える
    - Lisp評価器；Lispオブジェクトを評価する
    - Lispオブジェクトが評価後、入力テキストと同じ書式になるとは限らない
```
? 10
10
? 20/2
10
? #xa
10
```
- 有理数とその標準形
- 整数、分数、二進数（#B,#b）、八進数（#O,#o）、16進数（#X,#x）、それ以外の基数（#nr）
```
? 123
123
? +123
123
? -123
-123
? 123.
123
? 2/3
2/3
? -2/3
-2/3
? 4/6
2/3
? 6/3
2
? #b10101
21
? #b10101/10101
1
? #o7
7
? #o777
511
? #xDADA
56026
? #36rABCDEFGHIJKLMNOPQRSTUVWXYZ
8337503854730415241050377135811259267835
```

- 浮動小数点（short、single、double、long）
```
? 1.0
1.0
? 1e0
1.0
? 1d0
1.0D0
? 123.0
123.0
? 123e0
123.0
? 0.123
0.123
? .123
0.123
? 123e-3
0.123
? 123E-3
0.123
? 0.123e20
1.23E+19
? 123d23
1.23D+25
```

- 複素数
    - 実数部と虚数部で表現
    - 実数部と虚数部は 両方とも有理数か同じ種類の浮動小数点型である必要がある
    - 種類が違う浮動小数点型が使われた場合、表現の津用法に引き上げられる
    - 虚部が0 の複素数はない；有理数に変換される
```
? #c(2 1)
#C(2 1)
? #c(2/3 3/4)
#C(2/3 3/4)
? #c(2 1.0)
#C(2.0 1.0)
? #c(2.0 1.0d0)
#C(2.0D0 1.0D0)
? #c(1/2 1.0)
#C(0.5 1.0)
? #c(3 0)
3
? #c(1/2 0)
1/2
? #c(-6/3 0)
-2
```

## 10.3 基本的な数学

- 基本的な代数演算（加算、減算、積算、除算） は `+`、`-`、`*`、`/` という関数でサポート
    - 複数の引数を与えられる
    - 単一の引数しか割り当てられない場合
        - `+`, `*` は値そのものを返す
        - `-` は反転を返す
        - `/` は逆数を返す
```
? (+ 1 2)
3
? (+ 1 2 3)
6
? (+ 10.0 3.0)
13.0
? (+ #c(1 2) #c(3 4))
#C(4 6)
? (- 5 4)
1
? (- 2)
-2
? (- 10 3 5)
2
? (* 2 3)
6
? (* 2 3 4)
24
? (/ 10 5)
2
? (/ 2 3)
2/3
? (/ 4)
1/4
```

- 引数が全て同じ型の数値なら結果も同じ型になる
    - 有理数からなる複素数演算で虚数が0になる場合、結果は有理数になる
    - 実数の引数の中に浮動小数点が一つでもあれば最も表現が広い範囲のものに変換される
    - 複素数も同様に一つでも引数にあれば対応する複素数に変換される
```
? (+ 1 2.0)
3.0
? (/ 2 3.0)
0.6666667
? (+ #c(1 2) 3)
#C(4 2)
? (+ #c(1 2) 3/2)
#C(5/2 2)
? (+ #c(1 1) #c(2 -1))
3
```
- `/` は結果を切り捨てないため切り捨てや丸めなどの関数が用意されている
    - `FLOOR` : 負の無限大の方向に切り捨てる
    - `CEILING` ： 正の無限大方向に切り上げる
    - `ROUND` : 最も近い整数に丸める。ちょうど中間値の場合偶数方向に丸める
    - `MOD` `REM` ： JIS素通しの割り算における法、剰余を返す
- `1+` `1-` 関数
    - 数値に1 を加算、減算した数値を返す関数
    - 関数は新しい数値を返す
- `INCF` `DECF` 関数
    - 数値に1 を加算、減算した数値を返す関数
    - 関数は引数で与えられた数値を変更する


