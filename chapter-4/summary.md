# 4章 シンタックスとセマンティクス

- 駆け足のツアーはこれでおしまい
- ここからは今までに使った機能を体系的に見ていく
- そのまえによくある質問に答えておく

## 4.1 なんでこんなに括弧があるの？

- Lispの特徴は 括弧の多用 と 全治気泡
- Lispのシンタックスはマクロを知ると理解できる
- Jhon Mcarthy曰く
  - M式（Algolに似たシンタックス）を使う予定だった
  - 完成することができなかった
  - S式を気に入るプログラマが出てきた

## 4.2 ブラックボックスをばらして中を見てみると

- 大抵の言語処理系
  - 内部構造はフェーズごとに別れたブラックボックス
  - ブラックボックス中でプログラムを実行している
  - よくあるのは処理系を3つのフェーズに分解
    - 字句解析器；文字列を分割し字句へ落とし込む
    - パーサ；抽象構文木（ATL）を作る
    - 評価器；抽象構文木（ATL）を評価し実行する

- CommonLispの場合
  - 2つのブラックボックス
    - 読取器；reader
      - 文字列がどのようなS式になるか決める
    - 評価器；evaluter
      - S式からLispのフォームを決める
      - Lispフォーム；括弧先頭がデータではないもの
  - 利点
    - S式を外部における
    - プログラムでのS式の組み立てが簡単
    - プログラムをコード内で簡単に生成可能

## 4.3 S式

- S式の基本的な構成要素；リストとアトム
- リスト
  - 空白で区切られた要素
  - 要素；S式
- アトム
  - 数値
    - 数字の列
    - 数字列に記号が含まれていても数値（-1/2、1.0d0
  - 文字リテラル
    - ダブルクオートで囲まれた文字
    - ダブルクオート、バックスラッシュだけは エスケープの必要あり
    - エスケープ文字はバックスラッシュ
  - シンボル
    - 関数名、変数名
    - 読み取り機はシンボルを区別しない
    - シンボルに使える文字
      - ほとんど使える
      - 数値として認識されなければ数字も使える
      - ピリオドだけで構成されるシンボルは使えない
    - シンボルに使えない文字
      - 空白文字は使えない
      - ()"'`.,:;\| は別のシンタックスに使用されているため使えない
    - 読取器が シンボルオブジェクトを作る方法
      - 英子文字は全て大文字に; foo -> FOO
      - |、\ がついている場合はそのまま；|foo| -> foo, \f\o\o -> foo
- シンボル名で同一オブジェクトであることを保証するしくみ
  - 読取器がシンボルのインターン（intern）を行う
  - シンボルをパッケージ（package）に保存
  - 新しいシンボルを見つけたら大文字変換→パッケージ内検索
  - 見つかったらそれを使い、見つからなかったら新たに追加 
- Lispの命名規約
  - ハイフンを使った命名；hello-world（ケバブケース）
  - ダイナミック変数(スペシャル変数)の先頭と末尾に「＊」をつける；*db*
  - 定数の先頭と末尾に「＋」をつける
  − 下位層の関数の先頭に「%」「%%」をつけるプログラマもいる


  
