# 5章 関数

- Lisp三大要素；関数、変数、マクロ
- この章では関数について解説する
  - Lispそのものが大部分は関数で構成されている
    - 言語仕様の 3/4 以上が関数の名前
    - 組み込みデータ型にしても「その型を扱う関数が何か」という形で定義
      - どういういみ?
  - マクロも最終的には関数を生成する
    - マクロそのものも関数
      - プログラムの作用を決める関数ではなく
      - コードそのものを生成する関数

## 5.1 新しい関数の定義

- 通常、関数は DEFUNマクロを使って定義される
  - DEFUNってマクロなのか！
  - LAMBDAを作り出すマクロなんだろうな
- ex: 関数の基本的な骨組み
  - `*`がついてるやつはなんじゃろ？
```
(defun name (parameter*)
  "省略可能なドキュメンテーション"
  body-form*)
```

- 関数の名前(name)
  - どのようなシンボルでもる帰る
  - 通常関数の名前はアルファベットとハイフンを使う
    - Lispではケバブケース(kebab-case)を使うのが良い
    - キャメルケース（CamelCase）, スネークケース(snake_case)はあまり使わない
  - ほかの命名規約もある
    - ある種類の値を別な種類に変更する関数の名前には`->` を使うこともある
    - ex) `string->widget`
- 関数のパラメータ(parameter)
  - 関数を呼ぶときに渡す引数を定義する
  - ラムダリストとも呼ばれる
    - Lamda関数の歴史的な関係から
  - 関数が引数を受け取らないときは `()`
  - 引数の種類
    - 必須パラメータ
    - オプショナルパラメータ
    - マルチプルパラメータ
    - キーワードパラメータ
  - 本文(body-form*)
    - 任意の個数のLisp式
    - 順番に評価され最後の式の値が関数の値として返される
    - 最後の式を戻り値として使用したくない場合 RETURN-FORM という特殊オペレータを使う

## 5.2  関数のパラメータリスト

- 通常のパラメータリスト；必須パラメータ
  - 引数が足りない、もしくは多い場合Lispはエラーを通知する

### 5.2.1 オプショナルパラメータ

- 必須ではないオプショナルな引数を定義するために使う
- `&optional` というシンボルを使用する
- ex)
```
(defun foo  (a b &optional c d) (list a b c d))

(foo 1 2) -> (1 2 nil nil)
(foo 1 2 3) -> (1 2 3 nil)
(foo 1 2 3 4) -> (1 2 3 4)
```

- オプショナルパラメータに初期値を与えることもできる
- ex)
```
(defun foo (a &optional (b 10)) (list a b))

(foo 1) -> (1 10)
(foo 1 2) -> (1 2)
```

- オプショナルパラメータが呼び出し元で指定されたのかデフォルト値なのかを見分ける方法もある
- 規約；オプショナルパラメータに `-supplied-p` をつける
- ex)
```
(defun foo (a b &optional (c 3 c-supplied-p))
  (list a b c c-supplied-p))

(foo 1 2) -> (1 2 3 nil)
(foo 1 2 3) -> (1 2 3 T)
(foo 1 2 4) -> (1 2 4 T)
```

